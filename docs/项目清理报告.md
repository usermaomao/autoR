# autoR 项目清理报告

> 生成日期：2025-01-27
> 扫描范围：/home/momo/github_proj/autoR

---

## 📊 清理前统计

| 类型 | 数量/大小 | 说明 |
|------|----------|------|
| Python 缓存文件 | 1245 个 | `__pycache__` 目录和 `.pyc` 文件 |
| 虚拟环境 | 137 MB | `backend/venv` |
| Node 依赖 | 92 MB | `frontend/node_modules` |
| 前端构建产物 | 540 KB | `frontend/dist` |
| ECDICT 子模块 | - | `.git` 目录 + 备份脚本 |
| 数据库 | 487 MB | `db.sqlite3`（含 ECDICT 数据）|

**总可清理空间**：约 **230 MB**

---

## 🗑️ 推荐清理清单

### ✅ 第一级：安全删除（推荐）

这些文件可以随时重新生成，删除不会影响项目运行。

| 文件/目录 | 大小 | 说明 | 如何恢复 |
|----------|------|------|----------|
| **所有 `__pycache__`** | ~5 MB | Python 字节码缓存 | 运行 Python 自动生成 |
| **所有 `.pyc` 文件** | ~2 MB | Python 编译文件 | 运行 Python 自动生成 |
| **`frontend/node_modules`** | 92 MB | Node.js 依赖 | `npm install` |
| **`frontend/dist`** | 540 KB | 前端构建产物 | `npm run build` |
| **`frontend/.vite`** | <1 MB | Vite 缓存 | Vite 自动生成 |
| **`backend/data/ECDICT/.backup`** | 108 KB | 旧的工具脚本 | 无需恢复 |

**清理命令**：
```bash
# 清理 Python 缓存
find . -type d -name "__pycache__" -exec rm -rf {} +
find . -type f -name "*.pyc" -delete

# 清理前端依赖和构建产物（可选）
rm -rf frontend/node_modules
rm -rf frontend/dist
rm -rf frontend/.vite

# 清理备份脚本
rm -rf backend/data/ECDICT/.backup
```

---

### ⚠️ 第二级：可选清理（需谨慎）

这些文件较大但可重建，删除后需要重新安装/生成。

| 文件/目录 | 大小 | 说明 | 影响 |
|----------|------|------|------|
| **`backend/venv`** | 137 MB | Python 虚拟环境 | 删除后需重新创建虚拟环境 |
| **`backend/data/ECDICT/.git`** | ~10 MB | ECDICT 子模块 Git | 失去 ECDICT 更新历史 |

**清理命令**：
```bash
# 清理虚拟环境（需重建）
rm -rf backend/venv

# 恢复命令：
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

---

### ❌ 第三级：不推荐删除

这些文件是项目核心，删除会导致功能丢失。

| 文件/目录 | 大小 | 说明 | 后果 |
|----------|------|------|------|
| **`backend/db/db.sqlite3`** | 487 MB | 数据库（含 ECDICT） | 丢失所有卡片和 77 万词库数据 |
| **测试文件** | ~30 KB | `test_*.py` 文件 | 丢失测试用例 |

⚠️ **数据库说明**：
- 487 MB 主要是 ECDICT 词库（77 万英文单词）
- 如果不需要离线词库，可以删除后重新导入
- 用户数据（卡片、复习记录）约占 <10 MB

---

## 🚀 一键清理脚本

### 方案 A：基础清理（推荐）

仅清理缓存和临时文件，不删除依赖。

```bash
#!/bin/bash
# cleanup-safe.sh

echo "🧹 开始清理项目..."

# 清理 Python 缓存
echo "清理 Python 缓存..."
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null
find . -type f -name "*.pyc" -delete 2>/dev/null
find . -type f -name "*.pyo" -delete 2>/dev/null

# 清理前端缓存
echo "清理前端缓存..."
rm -rf frontend/.vite 2>/dev/null

# 清理备份文件
echo "清理备份文件..."
rm -rf backend/data/ECDICT/.backup 2>/dev/null

echo "✅ 清理完成！节省约 10 MB 空间"
```

### 方案 B：深度清理（需重建依赖）

清理所有可重建文件，包括依赖。

```bash
#!/bin/bash
# cleanup-deep.sh

echo "🧹 开始深度清理..."

# 清理 Python 缓存
echo "清理 Python 缓存..."
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null
find . -type f -name "*.pyc" -delete 2>/dev/null

# 清理虚拟环境
echo "清理虚拟环境..."
rm -rf backend/venv

# 清理前端依赖和构建产物
echo "清理前端依赖..."
rm -rf frontend/node_modules
rm -rf frontend/dist
rm -rf frontend/.vite

# 清理备份
rm -rf backend/data/ECDICT/.backup

echo "✅ 深度清理完成！节省约 230 MB 空间"
echo ""
echo "⚠️  重建依赖："
echo "后端: cd backend && python3 -m venv venv && source venv/bin/activate && pip install -r requirements.txt"
echo "前端: cd frontend && npm install"
```

---

## 📝 .gitignore 更新建议

为避免将缓存文件提交到 Git，建议更新 `.gitignore`：

```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg
venv/
ENV/
env/

# Node
node_modules/
dist/
.vite/
*.log

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Database (可选)
# *.sqlite3

# Test
.pytest_cache/
.coverage
htmlcov/
```

---

## 🎯 推荐执行步骤

### 立即执行（安全）

```bash
# 1. 清理 Python 缓存
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null
find . -type f -name "*.pyc" -delete

# 2. 清理前端缓存
rm -rf frontend/.vite

# 3. 清理备份脚本
rm -rf backend/data/ECDICT/.backup

# 4. 验证项目仍可运行
cd backend && python3 manage.py check
cd frontend && npm run build
```

### 可选执行（需重建）

```bash
# 清理前端依赖（仅当需要重新安装时）
rm -rf frontend/node_modules frontend/dist

# 重建
cd frontend && npm install

# 清理虚拟环境（仅当需要重新创建时）
rm -rf backend/venv
cd backend && python3 -m venv venv && source venv/bin/activate && pip install -r requirements.txt
```

---

## 💾 备份建议

在执行深度清理前，建议备份以下内容：

```bash
# 备份数据库
cp backend/db/db.sqlite3 backend/db/db.sqlite3.backup

# 备份重要配置
cp backend/.env backend/.env.backup 2>/dev/null

# 或完整备份
tar -czf autoR-backup-$(date +%Y%m%d).tar.gz \
  backend/db/db.sqlite3 \
  backend/.env \
  frontend/.env
```

---

## 📈 预期效果

| 清理方案 | 节省空间 | 重建时间 | 风险 |
|---------|---------|---------|------|
| 基础清理 | ~10 MB | 0 分钟 | 无 |
| 中度清理 | ~100 MB | 2-5 分钟 | 低 |
| 深度清理 | ~230 MB | 5-10 分钟 | 低 |

---

**建议**：先执行基础清理，如果需要更多空间再考虑深度清理。
