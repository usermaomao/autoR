# autoR 快速启动指南

**版本**: v1.0
**更新日期**: 2025-11-20

---

## 🚀 一键启动

### 最简单的方式

```bash
# 进入项目根目录
cd /home/momo/github_proj/autoR

# 运行启动脚本
./start.sh
```

**启动模式选择**:
1. **完整模式** - 同时启动前端和后端（推荐）
2. **仅后端** - 只启动 Django API 服务
3. **仅前端** - 只启动 Vue 前端
4. **后台运行** - 在后台运行，不占用终端

---

## 📋 系统要求

### 必需软件
- **Python**: 3.8+ (当前系统: 3.10.12)
- **Node.js**: 18+ (当前系统: 22.17.0)
- **npm**: 8+ (当前系统: 11.4.2)

### 可选软件
- **tmux**: 用于分屏显示前后端（推荐安装）
  ```bash
  sudo apt install tmux
  ```

---

## 🛠️ 启动脚本说明

### 主启动脚本: `start.sh`

**功能**: 一键启动前端和后端服务

**使用方法**:
```bash
./start.sh
```

**特性**:
- ✅ 自动检查系统依赖
- ✅ 自动创建 Python 虚拟环境
- ✅ 自动安装依赖包
- ✅ 自动创建数据库
- ✅ 支持 tmux 分屏模式
- ✅ 支持后台运行模式

---

### 后端启动脚本: `scripts/start-backend.sh`

**功能**: 单独启动 Django 后端服务

**使用方法**:
```bash
./scripts/start-backend.sh
```

**自动执行的操作**:
1. 检查 Python 环境
2. 创建/激活虚拟环境
3. 安装依赖 (requirements.txt)
4. 检查数据库，必要时运行迁移
5. 启动 Django 开发服务器 (端口 8000)

**访问地址**:
- API 根路径: http://localhost:8000/api/
- Django 管理后台: http://localhost:8000/admin/

---

### 前端启动脚本: `scripts/start-frontend.sh`

**功能**: 单独启动 Vue 3 前端服务

**使用方法**:
```bash
./scripts/start-frontend.sh
```

**自动执行的操作**:
1. 检查 Node.js 环境
2. 检查 package.json 变更
3. 安装/更新依赖 (npm install)
4. 启动 Vite 开发服务器 (端口 5173)

**访问地址**:
- 前端页面: http://localhost:5173/

---

### 停止服务脚本: `stop.sh`

**功能**: 停止所有运行中的服务

**使用方法**:
```bash
./stop.sh
```

**停止顺序**:
1. 关闭 tmux 会话（如有）
2. 停止后台进程（通过 PID 文件）
3. 强制停止残留的 Django 和 Vite 进程
4. 可选：清理日志文件

---

### 网络检查脚本: `scripts/check-network.sh`

**功能**: 检查服务的网络监听状态和访问地址

**使用方法**:
```bash
./scripts/check-network.sh
```

**检查内容**:
1. WSL IP 地址
2. 端口监听状态（本地/局域网）
3. API 连通性测试
4. 访问地址汇总

---

## 🎯 快速上手流程

### 首次启动

```bash
# 1. 进入项目目录
cd /home/momo/github_proj/autoR

# 2. 运行一键启动脚本
./start.sh

# 3. 选择模式 1 (完整模式)
# 按提示操作，首次启动会自动配置环境

# 4. 等待服务启动完成
# 前端: http://localhost:5173
# 后端: http://localhost:8000
```

### 日常开发

```bash
# 快速启动（tmux 分屏模式）
./start.sh
# 选择模式 1

# 或者分别启动（开两个终端）
# 终端 1:
./scripts/start-backend.sh

# 终端 2:
./scripts/start-frontend.sh
```

### 停止服务

```bash
# 如果使用 tmux 模式
# 按 Ctrl+B, 然后按 D (分离会话)
# 或 Ctrl+C (在 tmux 窗口中)

# 如果分别启动
# 在各自终端按 Ctrl+C

# 或者使用停止脚本
./stop.sh
```

---

## 📊 启动模式详解

### 模式 1: 完整模式（推荐）

**特点**:
- 使用 tmux 分屏显示前后端日志
- 左侧窗口: 后端日志
- 右侧窗口: 前端日志
- 方便同时监控两个服务

**tmux 快捷键**:
```bash
Ctrl+B, 左/右箭头  # 切换窗口
Ctrl+B, D         # 分离会话（服务继续运行）
Ctrl+B, [         # 进入复制模式（可滚动查看日志）
Ctrl+C            # 停止当前窗口的服务
```

**重新附加到会话**:
```bash
tmux attach -t autoR
```

---

### 模式 2: 仅后端

**适用场景**:
- 仅开发后端 API
- 前端已单独启动
- 调试后端逻辑

**访问**:
- API: http://localhost:8000/api/
- Django Admin: http://localhost:8000/admin/

---

### 模式 3: 仅前端

**适用场景**:
- 仅开发前端界面
- 后端已单独启动
- 调试前端逻辑

**访问**:
- 前端: http://localhost:5173/

**注意**: 需要确保后端服务已在 8000 端口运行。

---

### 模式 4: 后台运行

**特点**:
- 服务在后台运行
- 不占用终端
- 适合长期运行

**日志查看**:
```bash
# 后端日志
tail -f /tmp/autoR-backend.log

# 前端日志
tail -f /tmp/autoR-frontend.log
```

**停止服务**:
```bash
# 使用停止脚本
./stop.sh

# 或手动停止
kill $(cat /tmp/autoR-backend.pid)
kill $(cat /tmp/autoR-frontend.pid)
```

---

## 🔧 高级配置

### 自定义端口

#### 修改后端端口
编辑 `scripts/start-backend.sh`:
```bash
# 将最后一行改为
python manage.py runserver 0.0.0.0:8888
```

#### 修改前端端口
编辑 `frontend/vite.config.js`:
```javascript
export default {
  server: {
    port: 3000  // 改为你想要的端口
  }
}
```

---

### 环境变量配置

创建 `backend/.env` 文件:
```bash
# Django 配置
DJANGO_SECRET_KEY=your-secret-key-here
DJANGO_DEBUG=True
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1

# CORS 配置
DJANGO_CORS_ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173
```

---

### 生产环境部署

**不要在生产环境使用这些开发脚本！**

生产环境应使用:
- **后端**: Gunicorn + Nginx
- **前端**: 构建后的静态文件（`npm run build`）
- **数据库**: PostgreSQL（而非 SQLite）
- **反向代理**: Nginx

参考文档:
- `docs/未实现功能分析报告.md` - Phase 5: 部署上线

---

## 🐛 常见问题

### 问题 1: 端口被占用

**错误信息**:
```
Error: That port is already in use
```

**解决方法**:
```bash
# 查找占用端口的进程
lsof -i :8000  # 后端
lsof -i :5173  # 前端

# 停止进程
kill -9 <PID>

# 或使用停止脚本
./stop.sh
```

---

### 问题 2: Python 依赖安装失败

**错误信息**:
```
ERROR: Could not find a version that satisfies the requirement...
```

**解决方法**:
```bash
# 升级 pip
cd backend
source venv/bin/activate
pip install --upgrade pip

# 重新安装依赖
pip install -r requirements.txt
```

---

### 问题 3: npm 依赖安装失败

**错误信息**:
```
npm ERR! code ERESOLVE
```

**解决方法**:
```bash
cd frontend

# 清理缓存
rm -rf node_modules package-lock.json
npm cache clean --force

# 重新安装
npm install
```

---

### 问题 4: 数据库迁移失败

**错误信息**:
```
django.db.migrations.exceptions.InconsistentMigrationHistory
```

**解决方法**:
```bash
# 开发环境：重置数据库
cd backend
rm db/db.sqlite3
python manage.py migrate

# 生产环境：请勿删除数据库！
# 联系数据库管理员
```

---

### 问题 5: CORS 错误

**错误信息**（浏览器控制台）:
```
Access to XMLHttpRequest at 'http://localhost:8000/api/'
has been blocked by CORS policy
```

**解决方法**:

检查 `backend/config/settings.py`:
```python
CORS_ALLOWED_ORIGINS = [
    "http://localhost:5173",
    "http://127.0.0.1:5173",
]

CSRF_TRUSTED_ORIGINS = [
    "http://localhost:5173",
    "http://127.0.0.1:5173",
]
```

确保前端地址在白名单中。

---

## 📞 获取帮助

### 文档资源
- `CLAUDE.md` - 完整开发指南
- `docs/项目整理完成报告.md` - 项目状态总结
- `docs/未实现功能分析报告.md` - 功能分析

### 日志查看
```bash
# 后端日志
tail -f /tmp/autoR-backend.log

# 前端日志
tail -f /tmp/autoR-frontend.log

# Django 调试信息
# 直接查看终端输出（如果前台运行）
```

### 调试技巧
1. **后端**: 在代码中添加 `import pdb; pdb.set_trace()` 设置断点
2. **前端**: 使用浏览器 DevTools (F12)
3. **API**: 使用 DRF Browsable API (http://localhost:8000/api/)

---

## 🌐 局域网访问配置

### 从 PC 访问 WSL 服务

默认情况下，服务已配置为支持局域网访问。

**访问地址**:
- 前端: http://172.17.33.11:5173/
- 后端: http://172.17.33.11:8000/api/
- 管理: http://172.17.33.11:8000/admin/

> **提示**: 运行 `./scripts/check-network.sh` 可以查看实时的 WSL IP 地址。

### 网络检查

```bash
# 检查网络状态
./scripts/check-network.sh

# 输出示例:
# ✓ WSL IP: 172.17.33.11
# ✓ 后端监听: 0.0.0.0:8000 (可从局域网访问)
# ✓ 前端监听: 0.0.0.0:5173 (可从局域网访问)
```

### 常见问题

**问题**: PC 无法访问 WSL 服务

**解决方法**:

1. **检查 Windows 防火墙**
   ```powershell
   # 在 Windows PowerShell (管理员) 中运行
   New-NetFirewallRule -DisplayName "WSL" -Direction Inbound `
     -InterfaceAlias "vEthernet (WSL)" -Action Allow
   ```

2. **确认服务监听状态**
   ```bash
   # 在 WSL 中运行
   netstat -tuln | grep -E ":8000|:5173"

   # 应该看到 0.0.0.0:8000 和 0.0.0.0:5173
   ```

3. **WSL IP 地址变化**

   如果 WSL 重启后 IP 变化，运行网络检查脚本查看新地址：
   ```bash
   ./scripts/check-network.sh
   ```

### 详细配置说明

查看完整的局域网访问配置文档：
```bash
docs/局域网访问配置.md
```

---

## ✅ 检查清单

启动前确认:
- [ ] Python 3.8+ 已安装
- [ ] Node.js 18+ 已安装
- [ ] 端口 8000 和 5173 未被占用
- [ ] 有足够的磁盘空间（至少 1GB）

首次启动后确认:
- [ ] 后端服务正常运行 (http://localhost:8000/api/)
- [ ] 前端页面正常打开 (http://localhost:5173/)
- [ ] 可以正常注册/登录
- [ ] API 请求无 CORS 错误

---

**脚本版本**: v1.0
**最后更新**: 2025-11-20
**维护**: Claude Code
