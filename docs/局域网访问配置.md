# autoR å±€åŸŸç½‘è®¿é—®é…ç½®è¯´æ˜

**æ›´æ–°æ—¥æœŸ**: 2025-11-20
**ç‰ˆæœ¬**: v1.0

---

## ğŸ“‹ é—®é¢˜æè¿°

ç”¨æˆ·æ— æ³•ä» PC æµè§ˆå™¨è®¿é—® WSL ä¸­è¿è¡Œçš„ autoR åº”ç”¨ã€‚

### æ ¹æœ¬åŸå› 

1. **åç«¯ä»…ç›‘å¬ localhost**ï¼šDjango é»˜è®¤ `runserver` åªç›‘å¬ 127.0.0.1ï¼Œå±€åŸŸç½‘æ— æ³•è®¿é—®
2. **å‰ç«¯æœªæš´éœ²åˆ°å±€åŸŸç½‘**ï¼šVite é»˜è®¤åªç›‘å¬ localhost
3. **CORS é™åˆ¶**ï¼šDjango CORS é…ç½®æœªåŒ…å«å±€åŸŸç½‘è®¿é—®

---

## âœ… å·²å®æ–½çš„ä¿®å¤

### 1. åç«¯é…ç½®ä¿®æ”¹

#### `backend/config/settings.py`

```python
# å…è®¸çš„ä¸»æœºåˆ—è¡¨ï¼ˆæ–°å¢ WSL IP å’Œ 0.0.0.0ï¼‰
ALLOWED_HOSTS = os.environ.get(
    'DJANGO_ALLOWED_HOSTS',
    'localhost,127.0.0.1,172.17.33.11,0.0.0.0'
).split(',')

# CORS é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒå…è®¸æ‰€æœ‰æ¥æºï¼‰
CORS_ALLOW_ALL_ORIGINS = DEBUG  # ä»…åœ¨ DEBUG=True æ—¶å…è®¸

# CSRF ä¿¡ä»»æ¥æº
CSRF_TRUSTED_ORIGINS = [
    "http://localhost:5173",
    "http://127.0.0.1:5173",
    "http://localhost:3000",
    "http://127.0.0.1:3000",
    "http://172.17.33.11:5173",  # WSL network IP
]

# SESSION è·¨åŸŸè®¾ç½®
SESSION_COOKIE_SAMESITE = 'Lax'
SESSION_COOKIE_SECURE = False  # å¼€å‘ç¯å¢ƒä½¿ç”¨ HTTP
CSRF_COOKIE_SAMESITE = 'Lax'
CSRF_COOKIE_SECURE = False
```

#### `scripts/start-backend.sh`

```bash
# ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£
python manage.py runserver 0.0.0.0:8000
```

### 2. å‰ç«¯é…ç½®ä¿®æ”¹

#### `frontend/vite.config.js`

```javascript
export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    },
  },
  server: {
    host: '0.0.0.0',  // ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://172.17.33.11:8000',  // æŒ‡å‘åç«¯çš„å±€åŸŸç½‘åœ°å€
        changeOrigin: true,
      }
    }
  }
})
```

#### `scripts/start-frontend.sh`

```bash
# è®¿é—®åœ°å€æ˜¾ç¤º
echo "  - æœ¬åœ°: http://localhost:5173/"
echo "  - å±€åŸŸç½‘: http://172.17.33.11:5173/"
```

### 3. ä¸»å¯åŠ¨è„šæœ¬ä¿®æ”¹

#### `start.sh` (æ¨¡å¼4 - åå°è¿è¡Œ)

```bash
# åç«¯å¯åŠ¨å‘½ä»¤
nohup python manage.py runserver 0.0.0.0:8000 > /tmp/autoR-backend.log 2>&1 &

# è®¿é—®åœ°å€æ˜¾ç¤º
echo "  - å‰ç«¯: http://172.17.33.11:5173/"
echo "  - åç«¯: http://172.17.33.11:8000/api/"
```

---

## ğŸŒ è®¿é—®åœ°å€

### WSL æœ¬åœ°è®¿é—®

- **å‰ç«¯**: http://localhost:5173/
- **åç«¯ API**: http://localhost:8000/api/
- **ç®¡ç†åå°**: http://localhost:8000/admin/

### PC å±€åŸŸç½‘è®¿é—®

- **å‰ç«¯**: http://172.17.33.11:5173/
- **åç«¯ API**: http://172.17.33.11:8000/api/
- **ç®¡ç†åå°**: http://172.17.33.11:8000/admin/

> **æ³¨æ„**: `172.17.33.11` æ˜¯å½“å‰ WSL çš„å±€åŸŸç½‘ IP åœ°å€ã€‚å¦‚æœ WSL é‡å¯å IP å˜åŒ–ï¼Œéœ€è¦æ›´æ–°é…ç½®ã€‚

---

## ğŸ” éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥æœåŠ¡ç›‘å¬çŠ¶æ€

```bash
# åç«¯åº”è¯¥ç›‘å¬ 0.0.0.0:8000
netstat -tuln | grep :8000
# è¾“å‡ºç¤ºä¾‹: tcp  0  0  0.0.0.0:8000  0.0.0.0:*  LISTEN

# å‰ç«¯åº”è¯¥ç›‘å¬ 0.0.0.0:5173
netstat -tuln | grep :5173
# è¾“å‡ºç¤ºä¾‹: tcp  0  0  0.0.0.0:5173  0.0.0.0:*  LISTEN
```

### 2. æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# åç«¯æ—¥å¿—
tail -f /tmp/autoR-backend.log

# å‰ç«¯æ—¥å¿—
tail -f /tmp/autoR-frontend.log
```

### 3. æµ‹è¯• API è®¿é—®

```bash
# ä» WSL å†…éƒ¨æµ‹è¯•
curl http://localhost:8000/api/

# ä» PC æµ‹è¯•ï¼ˆåœ¨ Windows PowerShell ä¸­ï¼‰
curl http://172.17.33.11:8000/api/
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: PC æ— æ³•è®¿é—® WSL æœåŠ¡

**ç—‡çŠ¶**: æµè§ˆå™¨æ˜¾ç¤º "æ— æ³•è®¿é—®æ­¤ç½‘ç«™"

**è§£å†³æ–¹æ³•**:

1. æ£€æŸ¥ Windows é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº† WSL ç«¯å£
   ```powershell
   # åœ¨ Windows PowerShell (ç®¡ç†å‘˜) ä¸­è¿è¡Œ
   New-NetFirewallRule -DisplayName "WSL" -Direction Inbound -InterfaceAlias "vEthernet (WSL)" -Action Allow
   ```

2. æ£€æŸ¥ WSL IP æ˜¯å¦æ­£ç¡®
   ```bash
   # åœ¨ WSL ä¸­è¿è¡Œ
   ip addr show eth0 | grep "inet "
   ```

### é—®é¢˜ 2: CORS é”™è¯¯

**ç—‡çŠ¶**: æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º "Access to XMLHttpRequest has been blocked by CORS policy"

**è§£å†³æ–¹æ³•**:

ç¡®è®¤ `backend/config/settings.py` ä¸­çš„é…ç½®ï¼š

```python
# å¼€å‘ç¯å¢ƒå…è®¸æ‰€æœ‰æ¥æº
CORS_ALLOW_ALL_ORIGINS = DEBUG

# æˆ–è€…æ˜¾å¼æ·»åŠ  PC çš„ IP
CORS_ALLOWED_ORIGINS = [
    "http://localhost:5173",
    "http://172.17.33.11:5173",
    "http://192.168.1.100:5173",  # æ·»åŠ æ‚¨ PC çš„ IP
]
```

### é—®é¢˜ 3: Session/Cookie æ— æ³•ä¿å­˜

**ç—‡çŠ¶**: ç™»å½•åç«‹å³é€€å‡ºï¼Œæ— æ³•ä¿æŒç™»å½•çŠ¶æ€

**è§£å†³æ–¹æ³•**:

æ£€æŸ¥ Cookie è®¾ç½®ï¼š

```python
# backend/config/settings.py
SESSION_COOKIE_SAMESITE = 'Lax'  # ä¸è¦ä½¿ç”¨ 'Strict'
SESSION_COOKIE_SECURE = False    # HTTP ç¯å¢ƒå¿…é¡»ä¸º False
```

### é—®é¢˜ 4: WSL IP åœ°å€å˜åŒ–

**ç—‡çŠ¶**: é‡å¯ WSL åæ— æ³•è®¿é—®

**è§£å†³æ–¹æ³•**:

1. è·å–æ–°çš„ WSL IP
   ```bash
   ip addr show eth0 | grep "inet " | awk '{print $2}' | cut -d/ -f1
   ```

2. æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„ IP åœ°å€
   - `backend/config/settings.py` (ALLOWED_HOSTS, CSRF_TRUSTED_ORIGINS)
   - `frontend/vite.config.js` (proxy.target)
   - `scripts/start-backend.sh` (è®¿é—®åœ°å€æ˜¾ç¤º)
   - `scripts/start-frontend.sh` (è®¿é—®åœ°å€æ˜¾ç¤º)
   - `start.sh` (è®¿é—®åœ°å€æ˜¾ç¤º)

---

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹

**âš ï¸ å½“å‰é…ç½®ä»…é€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼**

ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¶éœ€è¦ä¿®æ”¹ï¼š

1. **ç¦ç”¨ CORS_ALLOW_ALL_ORIGINS**
   ```python
   CORS_ALLOW_ALL_ORIGINS = False
   CORS_ALLOWED_ORIGINS = [
       "https://yourdomain.com",
   ]
   ```

2. **å¯ç”¨ HTTPS**
   ```python
   SESSION_COOKIE_SECURE = True
   CSRF_COOKIE_SECURE = True
   SECURE_SSL_REDIRECT = True
   ```

3. **ä½¿ç”¨ Gunicorn ä»£æ›¿ runserver**
   ```bash
   gunicorn config.wsgi:application --bind 0.0.0.0:8000
   ```

4. **ä½¿ç”¨ Nginx åå‘ä»£ç†**
   ```nginx
   location /api/ {
       proxy_pass http://127.0.0.1:8000;
       proxy_set_header Host $host;
       proxy_set_header X-Real-IP $remote_addr;
   }
   ```

5. **é™åˆ¶ ALLOWED_HOSTS**
   ```python
   ALLOWED_HOSTS = ['yourdomain.com', 'www.yourdomain.com']
   ```

---

## ğŸ“ é…ç½®æ–‡ä»¶æ¸…å•

ä¿®æ”¹æ¶‰åŠçš„æ–‡ä»¶ï¼š

- âœ… `backend/config/settings.py` - Django ä¸»é…ç½®
- âœ… `frontend/vite.config.js` - Vite é…ç½®
- âœ… `scripts/start-backend.sh` - åç«¯å¯åŠ¨è„šæœ¬
- âœ… `scripts/start-frontend.sh` - å‰ç«¯å¯åŠ¨è„šæœ¬
- âœ… `start.sh` - ä¸»å¯åŠ¨è„šæœ¬

---

## ğŸ¯ å¿«é€Ÿå¯åŠ¨

```bash
# åœæ­¢å½“å‰æœåŠ¡
./stop.sh

# å¯åŠ¨æœåŠ¡ï¼ˆè‡ªåŠ¨åº”ç”¨æ–°é…ç½®ï¼‰
./start.sh
# é€‰æ‹©æ¨¡å¼ 4 (åå°è¿è¡Œ) æˆ–æ¨¡å¼ 1 (tmux åˆ†å±)

# ä» PC æµè§ˆå™¨è®¿é—®
# http://172.17.33.11:5173/
```

---

**ç»´æŠ¤è€…**: Claude Code
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-11-20
